<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire de Documents Formation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .formations-list, .documents-list {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .formation-item {
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }

        .formation-item:hover {
            background-color: #f0f0f0;
        }

        .formation-item.selected {
            background-color: #e3f2fd;
        }

        .document-item {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .document-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .secondary {
            background-color: #2196F3;
        }

        .secondary:hover {
            background-color: #1976D2;
        }

        .dropzone {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            background-color: #f9f9f9;
            transition: all 0.3s ease;
            margin: 15px 0;
            cursor: pointer;
        }

        .dropzone.dragover {
            background-color: #e3f2fd;
            border-color: #2196F3;
        }

        .dropzone p {
            margin: 0;
            color: #666;
        }

        .file-preview {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-top: 10px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            width: 24px;
            height: 24px;
            fill: #d32f2f;
        }

        .remove-button {
            margin-left: auto;
            color: #d32f2f;
            cursor: pointer;
            padding: 5px;
        }

        .section-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #333;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .success-message {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Documents de Formation</h1>
        </div>
        
        <div class="content">
            <div class="formations-list">
                <h2 class="section-title">Formations</h2>
                <div id="formations-container"></div>
            </div>
            
            <div class="documents-list">
                <h2 class="section-title">Documents</h2>
                <div id="success-message" class="success-message"></div>
                <div id="documents-container"></div>
                
                <div class="upload-section">
                    <h3 class="section-title">Ajouter un document</h3>
                    <input type="text" id="doc-title" placeholder="Titre du document" />
                    <div id="dropzone" class="dropzone">
                        <p>Glissez et déposez un fichier PDF ici ou cliquez pour sélectionner</p>
                        <input type="file" id="doc-file" accept=".pdf" style="display: none;" />
                    </div>
                    <div id="file-preview"></div>
                    <button id="upload-btn" onclick="uploadDocument()" style="display: none;">
                        Ajouter le document
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let formations = [
            { id: 1, nom: 'Formation JavaScript' },
            { id: 2, nom: 'Formation HTML/CSS' }
        ];

        let documents = [
            { id: 1, formation_id: 1, titre: 'Introduction JS', fichier_lien: '/docs/intro-js.pdf' },
            { id: 2, formation_id: 1, titre: 'Variables et Types', fichier_lien: '/docs/variables.pdf' },
            { id: 3, formation_id: 2, titre: 'Bases HTML', fichier_lien: '/docs/html-basics.pdf' }
        ];

        let selectedFormationId = null;
        let currentFile = null;

        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('doc-file');
        const filePreview = document.getElementById('file-preview');
        const uploadBtn = document.getElementById('upload-btn');
        const successMessage = document.getElementById('success-message');

        function showMessage(message, duration = 3000) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, duration);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            dropzone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        }

        function handleFiles(files) {
            if (files.length > 0) {
                const file = files[0];
                if (file.type === 'application/pdf') {
                    currentFile = file;
                    showFilePreview(file);
                    uploadBtn.style.display = 'block';
                } else {
                    alert('Veuillez sélectionner un fichier PDF');
                }
            }
        }

        function showFilePreview(file) {
            filePreview.innerHTML = `
                <div class="file-preview">
                    <div class="file-info">
                        <svg class="file-icon" viewBox="0 0 24 24">
                            <path d="M14,2H6C4.9,2,4,2.9,4,4v16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8L14,2z M16,18H8v-2h8V18z M16,14H8v-2h8V14z M13,9V3.5 L18.5,9H13z"/>
                        </svg>
                        <span>${file.name}</span>
                    </div>
                    <span class="remove-button" onclick="removeFile()">✖</span>
                </div>
            `;
        }

        function removeFile() {
            currentFile = null;
            filePreview.innerHTML = '';
            fileInput.value = '';
            uploadBtn.style.display = 'none';
        }

        function openInOpenBoard(fichierLien) {
            if (window.sankore) {
                window.sankore.openFile(fichierLien);
                console.log('Document ouvert dans OpenBoard:', fichierLien);
            } else {
                console.log('API OpenBoard non disponible');
                alert('API OpenBoard non disponible - Simulation d\'ouverture');
                window.open(fichierLien);
            }
        }

        function saveModifiedDocument(docId) {
            if (window.sankore) {
                window.sankore.saveFileAs((savedFilePath) => {
                    showMessage('Document sauvegardé avec succès');
                });
            } else {
                showMessage('API OpenBoard non disponible - Simulation de sauvegarde');
            }
        }

        function uploadDocument() {
            const titleInput = document.getElementById('doc-title');
            
            if (!selectedFormationId) {
                alert('Veuillez sélectionner une formation');
                return;
            }

            if (!titleInput.value.trim()) {
                alert('Veuillez entrer un titre pour le document');
                return;
            }

            if (!currentFile) {
                alert('Veuillez sélectionner un fichier');
                return;
            }

            const newDoc = {
                id: documents.length + 1,
                formation_id: selectedFormationId,
                titre: titleInput.value,
                fichier_lien: URL.createObjectURL(currentFile)
            };

            documents.push(newDoc);
            showMessage('Document ajouté avec succès');
            titleInput.value = '';
            removeFile();
            renderDocuments();
        }

        function renderFormations() {
            const container = document.getElementById('formations-container');
            container.innerHTML = formations.map(formation => `
                <div class="formation-item ${formation.id === selectedFormationId ? 'selected' : ''}"
                     onclick="selectFormation(${formation.id})">
                    📁 ${formation.nom}
                </div>
            `).join('');
        }

        function renderDocuments() {
            const container = document.getElementById('documents-container');
            if (!selectedFormationId) {
                container.innerHTML = '<p>Sélectionnez une formation pour voir les documents</p>';
                return;
            }

            const filteredDocs = documents.filter(doc => doc.formation_id === selectedFormationId);
            if (filteredDocs.length === 0) {
                container.innerHTML = '<p>Aucun document dans cette formation</p>';
                return;
            }

            container.innerHTML = filteredDocs.map(doc => `
                <div class="document-item">
                    <div>📄 ${doc.titre}</div>
                    <div class="document-actions">
                        <button onclick="openInOpenBoard('${doc.fichier_lien}')">
                            Ouvrir dans OpenBoard
                        </button>
                        <button class="secondary" onclick="saveModifiedDocument(${doc.id})">
                            Sauvegarder une copie
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function selectFormation(formationId) {
            selectedFormationId = formationId;
            renderFormations();
            renderDocuments();
        }

        // Event Listeners
        dropzone.addEventListener('dragover', handleDragOver);
        dropzone.addEventListener('dragleave', handleDragLeave);
        dropzone.addEventListener('drop', handleDrop);
        dropzone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            renderFormations();
            renderDocuments();
        });
    </script>
</body>
</html>